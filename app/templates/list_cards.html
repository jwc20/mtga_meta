<style>
    .mana-pool {
        margin-top: 2rem;
        outline: 1px solid #ccc;
        border-radius: 5px;
        padding: 1rem;
    }

    .mana-table {
        display: table;
        margin-bottom: 0 !important;
    }

    .mana-table th {
        display: table-cell;
        text-align: center;
    }

    .mana-table td {
        display: table-cell;
        text-align: center;
    }

    .missing-cards {
        margin-top: 0.5rem;
    }

    .ms-cost {
        line-height: 0.2rem;
    }

    .deck-name {
        font-size: 0.8rem;
    }

    .mana-cost {
        display: contents;
    }

    ul li {
        list-style: none;
        margin: 0;
        padding-bottom: 0.2rem;
    }

    .card-hover {
        position: relative;
        cursor: pointer;
    }

    .card-image {
        display: none;
        position: fixed;
        inset-block-start: 50%;
        inset-inline-start: 50%;
        transform: translate(-50%, -50%);
        z-index: 1000;
        border-radius: 4.75% / 3.5%;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        width: 300px;
        max-inline-size: calc(100% - 2rem);
        max-block-size: calc(100% - 2rem);
    }

    .card-hover:hover .card-image {
        display: block;
    }

    .card-list {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        font-size: 0.5rem;
    }

    .card-list > :first-child {
        outline: 1px solid #ccc;
        border-radius: 5px;
        flex-basis: 14rem;
        flex-grow: 1;
        padding: 0.5rem;
    }

    .card-list > :last-child {
        flex-basis: 0;
        flex-grow: 999;
        min-inline-size: 50%;
    }

    .cards-list {
        list-style: none;
        padding: 0;
        margin: 0;
        gap: 10rem;
    }

    .cards-list li > span {
        flex-shrink: 0;
    }

    .cards-list li > span:first-child {
        width: 3rem;
    }

    .cards-list li > span:nth-child(2) {
        flex-grow: 1;
    }

    .deck-cards-list {
        list-style: none;
        padding: 0;
        margin: 0.5rem;
    }

    .deck-cards-list li > span {
        flex-shrink: 0;
    }

    .deck-cards-list li > span:nth-child(1) {
        width: 5rem;
    }

    .deck-cards-list li > span:nth-child(3) {
        flex-grow: 1;
    }


    .deck-cards-list li > span:nth-child(5) {
        width: 10rem;
    }

    .type-group {
        margin-top: 0.75rem;
    }

    .type-header {
        font-size: 0.5rem;
        font-weight: bold;
        color: #888;
        border-bottom: 1px solid #444;
        margin-bottom: 0.25rem;
    }

    .grid {
        display: grid;
        grid-gap: 1rem;
    }

    .grid > * {
        outline: 1px solid #ccc;
        border-radius: 5px;
        padding: 0.5rem;
    }

    @supports (width: min(300px, 100%)) {
        .grid {
            grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
        }
    }

    .card-playable {
        color: #4ade80;
        font-weight: bold;
    }

    .card-played {
        text-decoration: line-through;
    }

    .card-played-indicator {
        display: inline-block;
        margin-left: 0.25rem;
        color: #f59e0b;
        font-weight: bold;
    }

</style>

<div class="card-list">
    <section>
        <h5>Opponent's Cards</h5>
        {% set cards_with_types = cards|selectattr('types')|list %}
        {% for type, type_cards in cards_with_types|groupby('types') %}
        <div class="type-group">
            <div class="type-header">{{ type|title }}</div>
            <ul class="cards-list">
                {% for card in type_cards|sort(attribute='name') %}
                <li>
                            <span class="card-hover">
                                {% if card.printed_name %}
                                    {{ card.printed_name }}
                                {% else %}
                                    {{ card.name }}
                                {% endif %}
                                {% if card.id %}
                                    <img class="card-image"
                                         src="https://cards.scryfall.io/large/front/{{ card.id[0] }}/{{ card.id[1] }}/{{ card.id }}.jpg"
                                         alt="{{ card.name }}">
                                {% endif %}
                            </span>
                    <div class="mana-cost">
                        {{ card.mana_cost_tags | safe }}
                    </div>

                </li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}
        {% if missing_ids %}
        <div class="missing-cards">
            <span>Missing Cards: {{ missing_ids }}</span>
        </div>
        {% endif %}
        <div>
            <div class="mana-pool">
                <p>Basic Mana</p>
                <table class="mana-table">
                    {% if opponent_mana %}
                    <thead>
                    <tr>
                        {% for color, count in opponent_mana %}
                        <th>{{ color | safe }}</th>
                        {% endfor %}
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        {% for color, count in opponent_mana %}
                        <td>{{ count }}</td>
                        {% endfor %}
                    </tr>
                    </tbody>
                    {% endif %}

                </table>
            </div>
            <div class="mana-pool">
                <p>Producible Mana(Beta)</p>
                <table class="mana-table">
                    {% if producible_mana %}
                    <thead>
                    <tr>
                        {% for color, count in producible_mana %}
                        <th>{{ color | safe }}</th>
                        {% endfor %}
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        {% for color, count in producible_mana %}
                        <td>{{ count }}</td>
                        {% endfor %}
                    </tr>
                    </tbody>
                    {% endif %}

                </table>
            </div>
        </div>
    </section>
    <section>
        <div class="meta-decks">
            <div class="grid">
                {% for deck in matching_decks %}
                <div>
                    <div>
                        <a class="deck-name" href="{{ deck['url'] }}" target="_blank">{{ deck.name }}</a>
                        <span>  ({{ deck.matched_cards }} / {{ deck.total_deck_cards }})</span>
                    </div>

                    {% set cards_with_types = deck.cards|selectattr('types')|list %}

                    {% for type, type_cards in cards_with_types|groupby('types') %}
                    <div class="type-group">
                        <div class="type-header">{{ type }}</div>
                        <ul class="deck-cards-list">
                            {% for card in type_cards|sort(attribute='mana_cost_value', reverse=true) %}
                            {% set is_played = card.current_count is defined and card.current_count > 0 %}
                            <li>
                                            <span class="card-hover{% if card.is_playable %} card-playable{% endif %}{% if is_played %} card-played{% endif %}">
                                                {{ card.name }}
                                                {% if card.id %}
                                                    <img class="card-image"
                                                         src="https://cards.scryfall.io/large/front/{{ card.id[0] }}/{{ card.id[1] }}/{{ card.id }}.jpg"
                                                         alt="{{ card.name }}">
                                                {% endif %}
                                            </span>
                                {% if is_played %}
                                <span class="card-played-indicator">âœ“</span>{% endif %}
                                <div class="mana-cost">
                                    <span>{{ card.mana_cost_tags | safe }}</span>
                                </div>

                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
</div>